


<template name="localvideoplayer">
	<style>
video, input {
    display: block;
}

input {
    width: 100%;
}

.info {
    background-color: aqua;
}

.error {
    background-color: red;
    color: white;
}

	</style>

	<select class="form-control" name="category" id="activeTest">
                  <option value="Behavioral tests and codes">Behavioral tests and codes</option>
                  <option value="Pairing Test">Pairing Test</option>
                   <option value="Pairing Test II">Pairing Test</option>
                  <option value="Intrasexual Aggression">Intrasexual Aggression</option>
                   <option value="Pup Retrieval">Pup Retrieval</option>
                    <option value="Pup Retrieval II">Pup Retrieval II</option>
                   <option value="Partner Preference">Partner Preference</option>
    </select>

	<div id="message"></div>
	<input class="form-control" type="file" accept="video/*"/>
	<video  id="myVideo" width="480" height="360" controls preload="none"></video>

	<script>
(function localFileVideoPlayerInit(win) {
    var URL = win.URL || win.webkitURL,
        displayMessage = (function displayMessageInit() {
            var node = document.querySelector('#message');

            return function displayMessage(message, isError) {
                node.innerHTML = message;
                node.className = isError ? 'error' : 'info';
            };
        }()),
        playSelectedFile = function playSelectedFileInit(event) {
            var file = this.files[0];

            var type = file.type;

            var videoNode = document.querySelector('video');

            var canPlay = videoNode.canPlayType(type);

            canPlay = (canPlay === '' ? 'no' : canPlay);

            var message = 'Video has been loaded. Press play to begin test for "' + type + '": ' + canPlay;

            var isError = canPlay === 'no';

            displayMessage(message, isError);

            if (isError) {
                return;
            }

            var fileURL = URL.createObjectURL(file);

            videoNode.src = fileURL;
        },
        inputNode = document.querySelector('input');

    if (!URL) {
        displayMessage('Your browser is not ' +
           '<a href="http://caniuse.com/bloburls">supported</a>!', true);

        return;
    }

    inputNode.addEventListener('change', playSelectedFile, false);
}(window));

	</script>


<script>
$('#myVideo').on('play', function (e) {
  //  $('#myModal').modal('show');

	// my collection code
	 var myClocks = BehaviorClocks.find({}, {sort: {behaviorname: -1}});
	 var count = 0;
	var isStartTime = true;

	  myClocks.forEach(function (clock) {
	      console.log("Title of clocky " + count + ": " + clock.behaviorname + clock.shortcutKey);
	     //  count += 1;
	     // var a = document.getElementById("{{clockID}}");
	     //   var timer = new Stopwatch(a);
	     //   a.start();
	    Mousetrap.bind(clock.shortcutKey, function() {


	      var clocktime = $("#myVideo").currentTime;

	      var timetest = $("#a-timer span").text();
	      console.log(timetest);
	      // console.log($("#myVideo").currentTime)
	       console.log("triggered" + clock.clockID);
	       if(clock.timerType == "frequency") {
	          // get the data we need from the form
	          var newEvent = {
	            behaviorname: clock.behaviorname,
	            time: timetest
	          };
	          // create the new poll
	          BehaviorEvents.insert(newEvent);
	       }

	       else if(clock.timerType == "duration") {
	          var newEvent = {
	            behaviorname: clock.behaviorname,
	            time: timetest,
	            startTime: isStartTime
	            };
	          // create the new poll
	          BehaviorEvents.insert(newEvent);
	          if(isStartTime) {isStartTime = false;}
	          else if (!isStartTime) { isStartTime = true;}
	       }

	 // behaviorname: event.target.behaviorname.value,
	 //      shortcutKey: event.target.shortcutKey.value,
	 //      timerType: event.target.timerType.value,
	 //      category: event.target.category.value,
	 //      clockID: event.target.behaviorname.value + '-id'

	    });
	  });
});
</script>


</template>
